(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1b7927ce"],{"0858":function(e,t,r){"use strict";r("ab1d")},"583b":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"pa-3"},[r("v-snackbar",{attrs:{timeout:e.snackbar.timeout,top:"",color:"primary"},scopedSlots:e._u([{key:"action",fn:function(t){var a=t.attrs;return[r("v-btn",e._b({attrs:{color:"pink",text:""},on:{click:function(t){e.snackbar.display=!1}}},"v-btn",a,!1),[e._v(" Close ")])]}}]),model:{value:e.snackbar.display,callback:function(t){e.$set(e.snackbar,"display",t)},expression:"snackbar.display"}},[e._v(" "+e._s(e.snackbar.text)+" ")]),r("v-dialog",{attrs:{width:"70%"},model:{value:e.upLoadingDialog.show,callback:function(t){e.$set(e.upLoadingDialog,"show",t)},expression:"upLoadingDialog.show"}},[r("v-card",{staticClass:"mb-2 mx-auto",attrs:{loading:"",rounded:"lg",elevation:"16"}},[r("v-card-title",{staticClass:"justify-center",attrs:{"primary-title":""}},[e._v(e._s(e.upLoadingDialog.text))]),e.upLoadingDialog.upLoadingImage?r("v-card-text",[r("v-divider",{staticClass:"mb-2"}),r("table",[r("tbody",[r("tr",{staticClass:"title"},[r("td",[e._v("Percentage: ")]),r("td",[e._v(e._s(e.uploadedPercent))])]),r("tr",{staticClass:"title"},[r("td",[e._v("Total:")]),r("td",[e._v(e._s(e.uploadedTotal.toLocaleString()))])]),r("tr",{staticClass:"title"},[r("td",[e._v("Loaded:")]),r("td",[e._v(e._s(e.uploadedLoaded.toLocaleString()))])])])])],1):e._e()],1)],1),r("v-dialog",{attrs:{width:"400"},model:{value:e.previousMeterDialog,callback:function(t){e.previousMeterDialog=t},expression:"previousMeterDialog"}},[r("v-card",[r("v-card-title",[e._v(" Previous meter reading ")]),r("v-card-subtitle",[r("p",[e._v(" Account: "+e._s(this.meterReading.customer_id)+" ")])]),r("v-card-text",[r("v-row",[r("v-col",{attrs:{cols:"12"}},[r("v-text-field",{attrs:{type:"text",disabled:"",dense:"",outlined:"",label:"Meter Identifier",hint:"Meter Identifier"},model:{value:e.previousReading.meter_id,callback:function(t){e.$set(e.previousReading,"meter_id",t)},expression:"previousReading.meter_id"}}),r("v-text-field",{attrs:{type:"text",disabled:"",dense:"",outlined:"",label:"Meter Metric",hint:"Meter Metric"},model:{value:e.previousReading.meter_metric,callback:function(t){e.$set(e.previousReading,"meter_metric",t)},expression:"previousReading.meter_metric"}}),r("div",{staticClass:"d-flex"},[r("v-text-field",{staticClass:"mr-2",attrs:{type:"number",disabled:"",dense:"",outlined:"",label:"Meter Left",hint:"Meter Left"},model:{value:e.previousReading.meter_left,callback:function(t){e.$set(e.previousReading,"meter_left",t)},expression:"previousReading.meter_left"}}),r("v-text-field",{attrs:{type:"number",disabled:"",dense:"",outlined:"",label:"Meter Right",hint:"Meter Right"},model:{value:e.previousReading.meter_right,callback:function(t){e.$set(e.previousReading,"meter_right",t)},expression:"previousReading.meter_right"}})],1),r("v-text-field",{attrs:{type:"text",disabled:"",dense:"",value:e.computedReadDate,outlined:"",label:"Date",hint:"Reading Date"}}),r("v-textarea",{attrs:{type:"text",disabled:"",dense:"",outlined:"",label:"Comments:",readonly:""},model:{value:e.previousReading.omments,callback:function(t){e.$set(e.previousReading,"omments",t)},expression:"previousReading.omments"}})],1)],1)],1),r("v-card-actions",[r("v-spacer"),e.previousMeterImageAvailable?r("v-btn",{staticClass:"text-none",attrs:{loading:e.previousMeterImageLoading,size:"large"},on:{click:e.showLastestEngineerMeterImage}},[e._v("Show Photo")]):e._e(),r("v-btn",{staticClass:"text-none",attrs:{size:"large",color:"primary"},on:{click:function(t){e.previousMeterDialog=!1}}},[e._v("Close")])],1)],1)],1),r("vue-easy-lightbox",{attrs:{visible:e.lightBoxVisible,imgs:e.lightBoxImage},on:{hide:e.hideLightBoxImage}}),r("label",{staticClass:"d-none"},[r("input",{attrs:{id:"file-input",type:"file",accept:"image/*",capture:""},on:{change:e.imageChange}})]),r("label",{staticClass:"d-none"},[r("input",{attrs:{id:"file-input_gallery",type:"file",accept:"image/x-png,image/jpeg,image/gif"},on:{change:e.imageChangeGallery}})]),r("v-row",{staticClass:"pa-2 mb-2 d-flex justify-space-between align-baseline"},[r("div",[e._v("Engineer Meter Reading")]),r("div",[r("v-btn",{staticClass:"mx-2",attrs:{loading:e.loading,fab:"",medium:"",color:"error"},on:{click:e.showLastestEngineerMeter}},[r("v-icon",{attrs:{dark:""}},[e._v("mdi-page-previous")])],1)],1)]),r("v-row",[r("v-expansion-panels",{staticClass:"expansion_panels"},[r("customer",{attrs:{customer:e.customer}}),r("v-expansion-panel",{staticClass:"expansion_pane mb-1"},[r("v-expansion-panel-header",[r("div",[e._v("Meter Read")])]),r("v-expansion-panel-content",[r("v-row",[r("v-col",{attrs:{cols:"12",sm:"6"}},[r("v-form",{ref:"meterReadForm",model:{value:e.isFormValid,callback:function(t){e.isFormValid=t},expression:"isFormValid"}},[r("v-text-field",{attrs:{density:"comfortable",rules:e.meterIdRules,required:"",type:"text",clearable:"",hint:"Meter Identifier",outlined:"",label:"Meter Identifier"},model:{value:e.meterReading.meter_id,callback:function(t){e.$set(e.meterReading,"meter_id",t)},expression:"meterReading.meter_id"}}),r("div",{staticClass:"d-flex"},[r("v-text-field",{staticClass:"mr-2",attrs:{density:"comfortable",rules:e.meterLeftRules,required:"",type:"number",clearable:"",hint:"Meter Left",outlined:"",label:"Meter Left"},model:{value:e.meterReading.meter_left,callback:function(t){e.$set(e.meterReading,"meter_left",t)},expression:"meterReading.meter_left"}}),r("v-text-field",{attrs:{density:"comfortable",rules:e.meterRightRules,required:"",type:"number",clearable:"",hint:"Meter Right",outlined:"",label:"Meter Right"},model:{value:e.meterReading.meter_right,callback:function(t){e.$set(e.meterReading,"meter_right",t)},expression:"meterReading.meter_right"}})],1),r("v-container",{attrs:{fluid:""}},[r("p",[e._v("Meter Metric: "),r("strong",[e._v(e._s(e.meterReading.meter_metric))])]),r("v-radio-group",{attrs:{inline:""},model:{value:e.meterReading.meter_metric,callback:function(t){e.$set(e.meterReading,"meter_metric",t)},expression:"meterReading.meter_metric"}},[r("v-radio",{attrs:{label:"Meters",value:"Meters"}}),r("v-radio",{attrs:{label:"Feet",value:"Feet"}})],1)],1),r("v-textarea",{attrs:{dense:"",outlined:"",label:"Comments:"},model:{value:e.meterReading.comments,callback:function(t){e.$set(e.meterReading,"comments",t)},expression:"meterReading.comments"}}),r("v-card-actions",[r("v-btn",{staticClass:"text-none",attrs:{disabled:!e.isFormValid,loading:e.loading,elevation:"3",color:"success"},on:{click:e.uploadEngineerMeter}},[e._v("Upload Meter Read")]),r("v-spacer"),r("v-btn",{staticClass:"text-none",attrs:{elevation:"3",color:"error"},on:{click:e.resetMeterReadForm}},[e._v("Reset Form")])],1)],1)],1),r("v-col",{staticClass:"myborder pa-1",attrs:{cols:"12",sm:"6"}},[r("v-card-actions",[r("v-btn",{staticClass:"text-none",attrs:{text:"",color:"primary"},on:{click:function(t){return e.takeImageCamera()}}},[e._v("Camera ")]),r("v-btn",{staticClass:"text-none",attrs:{text:"",color:"primary"},on:{click:function(t){return e.takeImageGallery()}}},[e._v("Gallery ")]),r("v-spacer"),r("v-btn",{staticClass:"text-none",attrs:{text:"",color:"warning"},on:{click:function(t){return e.resetImage()}}},[e._v("Reset ")])],1),r("v-divider",{staticClass:"border-opacity-25"}),r("div",{staticClass:"ma-2 myborder"},[r("img",{staticClass:"myimg",attrs:{src:e.meterImage},on:{click:function(t){return e.showUpdatedMeterImage()}}})])],1)],1)],1)],1),r("v-expansion-panel",{staticClass:"expansion_panel mb-2"})],1)],1)],1)},i=[],n=r("c964e"),s=(r("d3b7"),r("96cf"),r("56d7")),o=r("af0d"),l={name:"meterRead",formName:"meterRead",destroyed:function(){s["store"].consoleLog("meterRead form destroyed"),this.customer=JSON.parse(localStorage.getItem("equalResponseCustomer")),this.engineer=JSON.parse(localStorage.getItem("equalResponseEngineer")),this.meterReading.engineer_id=this.engineer["ENGINEER_ID"],this.meterReading.customer_id=this.customer["ACCOUNT"],this.meterReading.meter_id=this.customer["USER5"],this.createSnapShot()},created:function(){s["store"].consoleLog("meterRead created"),this.customer=JSON.parse(localStorage.getItem("equalResponseCustomer")),this.engineer=JSON.parse(localStorage.getItem("equalResponseEngineer")),this.meterReading.engineer_id=this.engineer["ENGINEER_ID"],this.meterReading.customer_id=this.customer["ACCOUNT"],this.meterReading.meter_id=this.customer["USER5"],this.meterReading.meter_metric="Meters",this.meterImage=this.$restServer.engineerMeterImageEmpty,this.restoreSnapShot()},methods:{showLastestEngineerMeter:function(){var e=this,t=this.customer["ACCOUNT"];console.log("getEngineerMeter( '".concat(t,"' )"));var r=this.$restServer.engineerMeter,a=r+"/"+t;this.loading=!0,this.$http.get(a).then((function(t){var r=t.data;"success"===r.status?(e.previousReading.engineer_id=e.engineer["ENGINEER_ID"],e.previousReading.customer_id=e.customer["ACCOUNT"],e.previousReading.meter_id=e.customer["USER5"],e.previousReading.meter_left=r.meter_left,e.previousReading.meter_right=r.meter_right,e.previousReading.created_at=r.created_at,e.previousReading.meter_metric=r.meter_metric,e.previousReading.comments=r.comments,e.previousMeterImageAvailable=!!r.meter_image_path,e.loading=!1,e.previousMeterDialog=!0):"error"===r.status&&(e.snackbar.text=r.message,e.snackbar.display=!0,e.loading=!1)})).catch((function(t){e.snackbar.text=t.response.data.exception,e.snackbar.display=!0,e.loading=!1}))},showLastestEngineerMeterImage:function(){var e=this,t=this.customer["ACCOUNT"];console.log("showLastestEngineerMeterImage( '".concat(t,"' )"));var r=this.$restServer.engineerMeterImageLink,a=r+"/"+t;this.previousMeterImageLoading=!0,this.$http.get(a).then((function(t){e.previousMeterImageLoading=!1,e.lightBoxImage=t.data,e.lightBoxVisible=!0})).catch((function(t){e.previousMeterImageLoading=!1,console.log(t)}))},uploadEngineerMeter:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,e.upLoadingDialog.show=!0,t.prev=2,e.upLoadingDialog.text="Uploading Meter Read . !!",e.upLoadingDialog.text="Uploading Meter Image.!!",e.upLoadingDialog.upLoadingImage=!0,t.next=8,e.postEngineerMeterImage();case 8:if(r=t.sent,"error"!=r.data.status){t.next=12;break}throw a=r.data.message,a;case 12:e.resetMeterReadForm(),t.next=20;break;case 15:t.prev=15,t.t0=t["catch"](2),e.snackbar.display=!0,e.snackbar.text=t.t0,e.snackbar.timeout="3000";case 20:return t.prev=20,e.loading=!1,e.upLoadingDialog.show=!1,e.upLoadingDialog.upLoadingImage=!1,e.upLoadingDialog.text="",t.finish(20);case 26:case"end":return t.stop()}}),t,null,[[2,15,20,26]])})))()},generateEngineerMeterObj:function(){var e={id:this.meterReading.customer_id,leftMeter:this.meterReading.meter_left,rightMeter:this.meterReading.meter_right};return e},generateEngineerMeterImageObj:function(){var e=new FormData,t=JSON.stringify(this.meterReading);return e.append("meterImage",this.meterImage),e.append("meterReading",t),e},postEngineerMeter:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var r,a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,r=e.$restServer.engineerMeter,a=e.generateEngineerMeterObj(),t.next=5,e.$http.post(r,a);case 5:return i=t.sent,t.abrupt("return",i);case 9:return t.prev=9,t.t0=t["catch"](0),t.abrupt("return",t.t0);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})))()},postEngineerMeterImage:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,r=e.generateEngineerMeterImageObj(),a=e.$restServer.engineerMeterImage,t.next=5,e.$http.post(a,r,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(t){e.uploadedPercent=parseInt(Math.round(t.loaded/t.total*100)),e.uploadedTotal=t.total,e.uploadedLoaded=t.loaded}});case 5:return t.abrupt("return",t.sent);case 8:return t.prev=8,t.t0=t["catch"](0),t.abrupt("return",t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))()},resetMeterReadForm:function(){this.meterReading.engineer_id=this.engineer["ENGINEER_ID"],this.meterReading.customer_id=this.customer["ACCOUNT"],this.meterReading.meter_id=this.customer["USER5"],this.meterReading.meter_metric="Meters",this.meterReading.meter_left=null,this.meterReading.meter_right=null,this.meterReading.comments=null,this.meterImage=this.$restServer.engineerMeterImnageEmpty,this.createSnapShot()},showUploadingDialog:function(){this.uploadingDialog=!0},closeUploadingDialog:function(){var e=this;setTimeout((function(){e.uploadingdDialog=!1}),2e3)},createSnapShot:function(){var e=this.generateSnapShot(),t=new o["a"](this.$dbName);t.collection(this.collection).doc(this.meterReading.customer_id).set(e).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))},restoreSnapShot:function(){var e=this,t=new o["a"](this.$dbName);t.collection(this.collection).doc(this.meterReading.customer_id).get().then((function(t){null!=t&&(e.meterReading=t["meterReading"],e.meterImage=t["meterImage"])})).catch((function(e){console.log(e)}))},generateSnapShot:function(){var e={meterImage:this.meterImage,meterReading:this.meterReading};return e},takeImageGallery:function(){document.getElementById("file-input_gallery").click()},takeImageCamera:function(){document.getElementById("file-input").click()},resetImage:function(){this.meterImage=this.$restServer.engineerMeterImageEmpty,this.meterReading.comments="",this.createSnapShot()},imageChangeGallery:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var r,a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,r=document.getElementById("file-input_gallery"),!(r.files.length>0)){t.next=10;break}return a=document.getElementById("file-input_gallery").files[0],t.next=6,e.getDataUrl(a);case 6:i=t.sent,e.meterImage=i,e.createSnapShot(),document.getElementById("file-input_gallery").value=null;case 10:t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](0),console.log(t.t0);case 15:case"end":return t.stop()}}),t,null,[[0,12]])})))()},imageChange:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var r,a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,r=document.getElementById("file-input"),!(r.files.length>0)){t.next=10;break}return a=r.files[0],t.next=6,e.getDataUrl(a);case 6:i=t.sent,e.meterImage=i,e.createSnapShot(),document.getElementById("file-input").value=null;case 10:t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](0),console.log(t.t0);case 15:case"end":return t.stop()}}),t,null,[[0,12]])})))()},getDataUrl:function(e){return new Promise((function(t,r){var a=new FileReader;a.readAsDataURL(e),a.addEventListener("load",(function(e){var r=e.target.result;t(r)})),a.addEventListener("error",(function(e){r(e)}))}))},showUpdatedMeterImage:function(){this.lightBoxImage=this.meterImage,this.lightBoxVisible=!0},hideLightBoxImage:function(){this.lightBoxImage=null,this.lightBoxVisible=!1}},computed:{computedReadDate:function(){if(this.previousReading.created_at){var e=new Date(this.previousReading.created_at);return e.toLocaleString("en-GB")}return""},computedPreviousReadingMeterImage:function(){return this.meterReading.previous_image?this.meterReading.previous_image:""}},data:function(){return{snackbar:{display:!1,text:"",timeout:3e3},loading:!1,previousMeterImageLoading:!1,previousMeterImageAvailable:!1,upLoadingDialog:{show:!1,upLoadingImage:!1,text:""},previousMeterDialog:!1,isFormValid:!1,uploadedPercent:0,uploadedTotal:0,uploadedLoaded:0,meterIdRules:[function(e){return!!e||"Meter Identifier is required"},function(e){return e&&e.length<=10||"Meter Identifier must be less than 10 characters"}],meterLeftRules:[function(e){return!!e||"Meter Left is required"},function(e){return e>0&&e<99999||"Meter Left must be between 0 and 99999"}],meterRightRules:[function(e){return!!e||"Meter Right is required"},function(e){return e>0&&e<99999||"Meter Right must be between 0 and 99999"}],meterMetricRules:[function(e){return!!e||"Meter Metric is required"},function(e){return e&&e.length<=10||"Value must be less than 10 characters"}],lightBoxVisible:!1,lightBoxImage:null,formName:"meterRead",customer:{},salesman:{},engineer:{},collection:"meterRead",previousReading:{engineer_id:"",customer_id:"",meter_id:"",meter_metric:"",meter_left:"",meter_right:"",comments:"",created_at:""},meterImage:this.$restServer.meterImageEmpty,meterReading:{engineer_id:"",customer_id:"",meter_id:"",meter_metric:"",meter_left:"",meter_right:"",comments:""}}}},c=l,d=(r("0858"),r("2877")),m=r("6544"),u=r.n(m),g=r("8336"),p=r("b0af"),v=r("99d9"),h=r("62ad"),f=r("a523"),b=r("169a"),R=r("ce7e"),_=r("cd55"),x=r("49e2"),I=r("c865"),M=r("0393"),k=r("4bd4"),C=r("132d"),y=r("67b6"),w=r("43a6"),E=r("0fd9"),L=r("2db4"),S=r("2fa4"),D=r("8654"),V=r("a844"),$=Object(d["a"])(c,a,i,!1,null,"93579c0c",null);t["default"]=$.exports;u()($,{VBtn:g["a"],VCard:p["a"],VCardActions:v["a"],VCardSubtitle:v["b"],VCardText:v["c"],VCardTitle:v["d"],VCol:h["a"],VContainer:f["a"],VDialog:b["a"],VDivider:R["a"],VExpansionPanel:_["a"],VExpansionPanelContent:x["a"],VExpansionPanelHeader:I["a"],VExpansionPanels:M["a"],VForm:k["a"],VIcon:C["a"],VRadio:y["a"],VRadioGroup:w["a"],VRow:E["a"],VSnackbar:L["a"],VSpacer:S["a"],VTextField:D["a"],VTextarea:V["a"]})},ab1d:function(e,t,r){}}]);
//# sourceMappingURL=chunk-1b7927ce.13439963.js.map