(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-779a84e9"],{"583b":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"pa-3"},[a("v-snackbar",{attrs:{timeout:e.snackbar.timeout,top:"",color:"primary"},scopedSlots:e._u([{key:"action",fn:function(t){var i=t.attrs;return[a("v-btn",e._b({attrs:{color:"pink",text:""},on:{click:function(t){e.snackbar.display=!1}}},"v-btn",i,!1),[e._v(" Close ")])]}}]),model:{value:e.snackbar.display,callback:function(t){e.$set(e.snackbar,"display",t)},expression:"snackbar.display"}},[e._v(" "+e._s(e.snackbar.text)+" ")]),a("v-dialog",{attrs:{width:"480"},model:{value:e.upLoadingDialog.show,callback:function(t){e.$set(e.upLoadingDialog,"show",t)},expression:"upLoadingDialog.show"}},[a("v-card",{staticClass:"mb-2 mx-auto",attrs:{loading:"",rounded:"lg",elevation:"16"}},[a("v-card-title",{staticClass:"justify-center",attrs:{"primary-title":""}},[e._v(e._s(e.upLoadingDialog.text))]),a("v-divider",{staticClass:"mb-2"}),a("v-card-text",[a("table",[a("tbody",[a("tr",{staticClass:"title"},[a("td",[e._v("Percentage: ")]),a("td",[e._v(e._s(e.uploadedPercent))])]),a("tr",{staticClass:"title"},[a("td",[e._v("Total:")]),a("td",[e._v(e._s(e.uploadedTotal.toLocaleString()))])]),a("tr",{staticClass:"title"},[a("td",[e._v("Loaded:")]),a("td",[e._v(e._s(e.uploadedLoaded.toLocaleString()))])])])])])],1)],1),a("v-dialog",{attrs:{width:"400"},model:{value:e.previousMeterDialog,callback:function(t){e.previousMeterDialog=t},expression:"previousMeterDialog"}},[a("v-card",[a("v-card-title",[e._v(" Previous meter reading ")]),a("v-card-subtitle",[a("p",[e._v(" Account: "+e._s(this.meterReading.customer_id)+" ")])]),a("v-card-text",[a("v-row",[a("v-col",{attrs:{cols:"12"}},[a("v-text-field",{attrs:{type:"text",disabled:"",dense:"",outlined:"",label:"Meter Identifier",hint:"Meter Identifier"},model:{value:e.previousReading.meter_id,callback:function(t){e.$set(e.previousReading,"meter_id",t)},expression:"previousReading.meter_id"}}),a("v-text-field",{attrs:{type:"text",disabled:"",dense:"",outlined:"",label:"Meter Metric",hint:"Meter Metric"},model:{value:e.previousReading.meter_metric,callback:function(t){e.$set(e.previousReading,"meter_metric",t)},expression:"previousReading.meter_metric"}}),a("div",{staticClass:"d-flex"},[a("v-text-field",{staticClass:"mr-2",attrs:{type:"number",disabled:"",dense:"",outlined:"",label:"Meter Left",hint:"Meter Left"},model:{value:e.previousReading.meter_left,callback:function(t){e.$set(e.previousReading,"meter_left",t)},expression:"previousReading.meter_left"}}),a("v-text-field",{attrs:{type:"number",disabled:"",dense:"",outlined:"",label:"Meter Right",hint:"Meter Right"},model:{value:e.previousReading.meter_right,callback:function(t){e.$set(e.previousReading,"meter_right",t)},expression:"previousReading.meter_right"}})],1),a("v-text-field",{attrs:{type:"text",disabled:"",dense:"",value:e.computedReadDate,outlined:"",label:"Date",hint:"Reading Date"}}),a("v-textarea",{attrs:{type:"text",disabled:"",dense:"",outlined:"",label:"Comments:",readonly:""},model:{value:e.previousReading.omments,callback:function(t){e.$set(e.previousReading,"omments",t)},expression:"previousReading.omments"}})],1)],1)],1),a("v-card-actions",[a("v-spacer"),e.previousMeterImageAvailable?a("v-btn",{staticClass:"text-none",attrs:{loading:e.previousMeterImageLoading,size:"large"},on:{click:e.showPreviousMeterImage}},[e._v("Show Photo")]):e._e(),a("v-btn",{staticClass:"text-none",attrs:{size:"large",color:"primary"},on:{click:function(t){e.previousMeterDialog=!1}}},[e._v("Close")])],1)],1)],1),a("vue-easy-lightbox",{attrs:{visible:e.lightBoxVisible,imgs:e.lightBoxImage},on:{hide:e.hideLightBoxImage}}),a("label",{staticClass:"d-none"},[a("input",{attrs:{id:"file-input",type:"file",accept:"image/*",capture:""},on:{change:e.imageChange}})]),a("label",{staticClass:"d-none"},[a("input",{attrs:{id:"file-input_gallery",type:"file",accept:"image/x-png,image/jpeg,image/gif"},on:{change:e.imageChangeGallery}})]),a("v-row",{staticClass:"pa-2 mb-2 d-flex justify-space-between align-baseline"},[a("div",[e._v("Engineer Meter Reading")]),a("div",[a("v-btn",{staticClass:"mx-2",attrs:{loading:e.loading,fab:"",medium:"",color:"error"},on:{click:e.showPreviousMeterDialog}},[a("v-icon",{attrs:{dark:""}},[e._v("mdi-page-previous")])],1)],1)]),a("v-row",[a("v-expansion-panels",{staticClass:"expansion_panels"},[a("customer",{attrs:{customer:e.customer}}),a("v-expansion-panel",{staticClass:"expansion_pane mb-1"},[a("v-expansion-panel-header",[a("div",[e._v("Meter Read")])]),a("v-expansion-panel-content",[a("v-row",[a("v-col",{attrs:{cols:"12",sm:"6"}},[a("v-form",{ref:"meterReadForm",model:{value:e.isFormValid,callback:function(t){e.isFormValid=t},expression:"isFormValid"}},[a("v-text-field",{attrs:{density:"comfortable",rules:e.meterIdRules,required:"",type:"text",clearable:"",hint:"Meter Identifier",outlined:"",label:"Meter Identifier"},model:{value:e.meterReading.meter_id,callback:function(t){e.$set(e.meterReading,"meter_id",t)},expression:"meterReading.meter_id"}}),a("div",{staticClass:"d-flex"},[a("v-text-field",{staticClass:"mr-2",attrs:{density:"comfortable",rules:e.meterLeftRules,required:"",type:"number",clearable:"",hint:"Meter Left",outlined:"",label:"Meter Left"},model:{value:e.meterReading.meter_left,callback:function(t){e.$set(e.meterReading,"meter_left",t)},expression:"meterReading.meter_left"}}),a("v-text-field",{attrs:{density:"comfortable",rules:e.meterRightRules,required:"",type:"number",clearable:"",hint:"Meter Right",outlined:"",label:"Meter Right"},model:{value:e.meterReading.meter_right,callback:function(t){e.$set(e.meterReading,"meter_right",t)},expression:"meterReading.meter_right"}})],1),a("v-container",{attrs:{fluid:""}},[a("p",[e._v("Meter Metric: "),a("strong",[e._v(e._s(e.meterReading.meter_metric))])]),a("v-radio-group",{attrs:{inline:""},model:{value:e.meterReading.meter_metric,callback:function(t){e.$set(e.meterReading,"meter_metric",t)},expression:"meterReading.meter_metric"}},[a("v-radio",{attrs:{label:"Meters",value:"Meters"}}),a("v-radio",{attrs:{label:"Feet",value:"Feet"}})],1)],1),a("v-textarea",{attrs:{type:"number",dense:"",outlined:"",label:"Reading Comments:"},model:{value:e.meterReading.comments,callback:function(t){e.$set(e.meterReading,"comments",t)},expression:"meterReading.comments"}}),a("v-card-actions",[a("v-btn",{staticClass:"text-none",attrs:{disabled:!e.isFormValid,loading:e.loading,elevation:"3",color:"success"},on:{click:e.postMeterRead}},[e._v("Upload Meter Read")]),a("v-spacer"),a("v-btn",{staticClass:"text-none",attrs:{elevation:"3",color:"error"},on:{click:e.resetMeterReadForm}},[e._v("Reset Form")])],1)],1)],1),a("v-col",{staticClass:"myborder pa-1",attrs:{cols:"12",sm:"6"}},[a("v-card-actions",[a("v-btn",{staticClass:"text-none",attrs:{text:"",color:"primary"},on:{click:function(t){return e.takeImageCamera()}}},[e._v("Camera ")]),a("v-btn",{staticClass:"text-none",attrs:{text:"",color:"primary"},on:{click:function(t){return e.takeImageGallery()}}},[e._v("Gallery ")]),a("v-spacer"),a("v-btn",{staticClass:"text-none",attrs:{text:"",color:"warning"},on:{click:function(t){return e.resetImage()}}},[e._v("Reset ")])],1),a("v-divider",{staticClass:"border-opacity-25"}),a("img",{staticClass:"myimg",attrs:{src:e.meterImage},on:{click:function(t){return e.showUpdatedMeterImage()}}})],1)],1)],1)],1),a("v-expansion-panel",{staticClass:"expansion_panel mb-2"})],1)],1)],1)},r=[],n=a("c964e"),s=(a("d3b7"),a("96cf"),a("56d7")),o=a("af0d"),l={name:"meterRead",formName:"meterRead",destroyed:function(){s["store"].consoleLog("meterRead form destroyed"),this.customer=JSON.parse(localStorage.getItem("equalResponseCustomer")),this.engineer=JSON.parse(localStorage.getItem("equalResponseEngineer")),this.meterReading.engineer_id=this.engineer["ENGINEER_ID"],this.meterReading.customer_id=this.customer["ACCOUNT"],this.meterReading.meter_id=this.customer["USER5"],this.createSnapShot()},created:function(){s["store"].consoleLog("meterRead created"),this.customer=JSON.parse(localStorage.getItem("equalResponseCustomer")),this.engineer=JSON.parse(localStorage.getItem("equalResponseEngineer")),this.meterReading.engineer_id=this.engineer["ENGINEER_ID"],this.meterReading.customer_id=this.customer["ACCOUNT"],this.meterReading.meter_id=this.customer["USER5"],this.meterReading.meter_metric="Meters",this.meterImage=this.$restServer.meterImageEmpty,this.restoreSnapShot()},methods:{showPreviousMeterDialog:function(){var e=this,t=this.customer["ACCOUNT"];console.log("getPreviousMeter( '".concat(t,"' )"));var a=this.$restServer.meter,i=a+"/"+t;this.loading=!0,this.$http.get(i).then((function(t){var a=t.data;e.previousReading.engineer_id=e.engineer["ENGINEER_ID"],e.previousReading.customer_id=e.customer["ACCOUNT"],e.previousReading.meter_id=e.customer["USER5"],e.previousReading.meter_metric=a.meter_metric,e.previousReading.meter_left=a.meter_left,e.previousReading.meter_right=a.meter_right,e.previousReading.created_at=a.created_at,e.loading=!1,e.previousMeterDialog=!0,e.previousMeterImageAvailable=!!a.meter_image_path})).catch((function(t){e.snackbar.text=t.response.data.exception,e.snackbar.display=!0,e.loading=!1}))},showPreviousMeterImage:function(){var e=this,t=this.customer["ACCOUNT"];console.log("showPreviousMeterImage( '".concat(t,"' )"));var a=this.$restServer.meterImageLink,i=a+"/"+t;this.previousMeterImageLoading=!0,this.$http.get(i).then((function(t){e.previousMeterImageLoading=!1,e.lightBoxImage=t.data,e.lightBoxVisible=!0})).catch((function(t){e.previousMeterImageLoading=!1,console.log(t)}))},postMeterRead:function(){var e=this,t=this.$restServer.meter;this.loading=!0,this.upLoadingDialog.show=!0,this.upLoadingDialog.text="Uploading Meter Read . !!";var a=new FormData;a.append("meterImage",this.meterImage),a.append("meterReading",JSON.stringify(this.meterReading)),this.$http.post(t,a,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(t){e.uploadedPercent=parseInt(Math.round(t.loaded/t.total*100)),e.uploadedTotal=t.total,e.uploadedLoaded=t.loaded}}).then((function(t){console.log(t),e.loading=!1,e.upLoadingDialog.show=!1,e.upLoadingDialog.text="",e.meterReading.meter_left=null,e.meterReading.meter_right=null,e.meterReading.comments=null})).catch((function(t){e.loading=!1,e.upLoadingDialog.show=!1,e.upLoadingDialog.text="",e.snackbar.display=!0,e.snackbar.text=t.message}))},resetMeterReadForm:function(){this.meterReading.engineer_id=this.engineer["ENGINEER_ID"],this.meterReading.customer_id=this.customer["ACCOUNT"],this.meterReading.meter_id=this.customer["USER5"],this.meterReading.meter_metric="Meters",this.meterReading.meter_left=null,this.meterReading.meter_right=null,this.meterReading.comments=null,this.meterImage=this.$restServer.meterImageEmpty,this.createSnapShot()},showUploadingDialog:function(){this.uploadingDialog=!0},closeUploadingDialog:function(){var e=this;setTimeout((function(){e.uploadingdDialog=!1}),2e3)},createSnapShot:function(){var e=this.generateSnapShot(),t=new o["a"](this.$dbName);t.collection(this.collection).doc(this.meterReading.customer_id).set(e).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))},restoreSnapShot:function(){var e=this,t=new o["a"](this.$dbName);t.collection(this.collection).doc(this.meterReading.customer_id).get().then((function(t){null!=t&&(e.meterReading=t["meterReading"],e.meterImage=t["meterImage"])})).catch((function(e){console.log(e)}))},generateSnapShot:function(){var e={meterImage:this.meterImage,meterReading:this.meterReading};return e},takeImageGallery:function(){document.getElementById("file-input_gallery").click()},takeImageCamera:function(){document.getElementById("file-input").click()},resetImage:function(){this.meterImage=this.$restServer.meterImageEmpty,this.createSnapShot()},imageChangeGallery:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a,i,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,a=document.getElementById("file-input_gallery"),!(a.files.length>0)){t.next=10;break}return i=document.getElementById("file-input_gallery").files[0],t.next=6,e.getDataUrl(i);case 6:r=t.sent,e.meterImage=r,e.createSnapShot(),document.getElementById("file-input_gallery").value=null;case 10:t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](0),console.log(t.t0);case 15:case"end":return t.stop()}}),t,null,[[0,12]])})))()},imageChange:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a,i,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,a=document.getElementById("file-input"),!(a.files.length>0)){t.next=10;break}return i=a.files[0],t.next=6,e.getDataUrl(i);case 6:r=t.sent,e.meterImage=r,e.createSnapShot(),document.getElementById("file-input").value=null;case 10:t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](0),console.log(t.t0);case 15:case"end":return t.stop()}}),t,null,[[0,12]])})))()},getDataUrl:function(e){return new Promise((function(t,a){var i=new FileReader;i.readAsDataURL(e),i.addEventListener("load",(function(e){var a=e.target.result;t(a)})),i.addEventListener("error",(function(e){a(e)}))}))},showUpdatedMeterImage:function(){this.lightBoxImage=this.meterImage,this.lightBoxVisible=!0},hideLightBoxImage:function(){this.lightBoxImage=null,this.lightBoxVisible=!1}},computed:{computedReadDate:function(){if(this.previousReading.created_at){var e=new Date(this.previousReading.created_at);return e.toLocaleString("en-GB")}return""},computedPreviousReadingMeterImage:function(){return this.meterReading.previous_image?this.meterReading.previous_image:""}},data:function(){return{snackbar:{display:!1,text:"",timeout:2e3},loading:!1,previousMeterImageLoading:!1,previousMeterImageAvailable:!1,upLoadingDialog:{show:!1,text:""},previousMeterDialog:!1,isFormValid:!1,uploadedPercent:0,uploadedTotal:0,uploadedLoaded:0,meterIdRules:[function(e){return!!e||"Meter Identifier is required"},function(e){return e&&e.length<=10||"Meter Identifier must be less than 10 characters"}],meterLeftRules:[function(e){return!!e||"Meter Left is required"},function(e){return e>0&&e<99999||"Meter Left must be between 0 and 99999"}],meterRightRules:[function(e){return!!e||"Meter Right is required"},function(e){return e>0&&e<99999||"Meter Right must be between 0 and 99999"}],meterMetricRules:[function(e){return!!e||"Meter Metric is required"},function(e){return e&&e.length<=10||"Value must be less than 10 characters"}],lightBoxVisible:!1,lightBoxImage:null,formName:"meterRead",customer:{},salesman:{},engineer:{},collection:"meterRead",previousReading:{engineer_id:"",customer_id:"",meter_id:"",meter_metric:"",meter_left:"",meter_right:"",comments:"",created_at:""},meterImage:this.$restServer.meterImageEmpty,meterReading:{engineer_id:"",customer_id:"",meter_id:"",meter_metric:"",meter_left:"",meter_right:"",comments:""}}}},d=l,c=(a("9622"),a("2877")),m=a("6544"),u=a.n(m),g=a("8336"),p=a("b0af"),v=a("99d9"),h=a("62ad"),f=a("a523"),R=a("169a"),_=a("ce7e"),b=a("cd55"),x=a("49e2"),I=a("c865"),M=a("0393"),C=a("4bd4"),y=a("132d"),k=a("67b6"),S=a("43a6"),w=a("0fd9"),D=a("2db4"),L=a("2fa4"),E=a("8654"),V=a("a844"),$=Object(c["a"])(d,i,r,!1,null,"3f7ef570",null);t["default"]=$.exports;u()($,{VBtn:g["a"],VCard:p["a"],VCardActions:v["a"],VCardSubtitle:v["b"],VCardText:v["c"],VCardTitle:v["d"],VCol:h["a"],VContainer:f["a"],VDialog:R["a"],VDivider:_["a"],VExpansionPanel:b["a"],VExpansionPanelContent:x["a"],VExpansionPanelHeader:I["a"],VExpansionPanels:M["a"],VForm:C["a"],VIcon:y["a"],VRadio:k["a"],VRadioGroup:S["a"],VRow:w["a"],VSnackbar:D["a"],VSpacer:L["a"],VTextField:E["a"],VTextarea:V["a"]})},9622:function(e,t,a){"use strict";a("989e")},"989e":function(e,t,a){}}]);
//# sourceMappingURL=chunk-779a84e9.e1a29364.js.map